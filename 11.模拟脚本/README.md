# æ¨¡æ‹Ÿè„šæœ¬å·¥å…·

## ğŸ¯ åŠŸèƒ½ç®€ä»‹

æ¨¡æ‹Ÿè„šæœ¬å·¥å…·å…è®¸æ‚¨æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•å‘½ä»¤ï¼Œæ”¯æŒå‚æ•°çš„åŠ¨æ€å¼•ç”¨å’Œå¼‚æ­¥ç­‰å¾…ã€‚éå¸¸é€‚åˆè‡ªåŠ¨åŒ–æµ‹è¯•æ¸¸æˆæœåŠ¡å™¨çš„ç™»å½•æµç¨‹ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
11.æ¨¡æ‹Ÿè„šæœ¬/
â”œâ”€â”€ main.py                # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ script_editor.py       # äº¤äº’å¼è„šæœ¬ç¼–è¾‘å™¨
â”œâ”€â”€ script_executor.py     # è„šæœ¬æ‰§è¡Œå¼•æ“
â”œâ”€â”€ quick_runner.py        # å¿«é€Ÿè¿è¡Œå™¨
â”œâ”€â”€ examples/              # ç¤ºä¾‹è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ login_flow.json    # å®Œæ•´ç™»å½•æµç¨‹
â”‚   â”œâ”€â”€ auth_only.json     # ä»…è®¤è¯å’Œé€‰æœ
â”‚   â””â”€â”€ direct_login.json  # ç›´æ¥ç™»å½•
â””â”€â”€ README.md              # è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œä¸»ç¨‹åº

```bash
python main.py
```

### 2. ä½¿ç”¨å¿«é€Ÿè¿è¡Œå™¨

```bash
python quick_runner.py
```

### 3. ç›´æ¥è¿è¡Œè„šæœ¬æ–‡ä»¶

```bash
python quick_runner.py login_flow.json
```

## ğŸ”§ å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | æè¿° | å‚æ•° | è‡ªåŠ¨è·å– |
|------|------|------|----------|
| `auth` | HTTPè®¤è¯ç™»å½• | user_name, channel | - |
| `select_area` | é€‰æ‹©æ¸¸æˆåŒºåŸŸ | open_id, area_id, login_token | - |
| `connect_gate` | è¿æ¥æ¸¸æˆç½‘å…³ | æ—  | è‡ªåŠ¨ä»select_areaè·å–GateHostå’ŒGateTcpPort |
| `connect_login` | è¿æ¥ç™»å½•æœåŠ¡å™¨ | æ—  | ä½¿ç”¨é…ç½®æ–‡ä»¶ |
| `login` | æ¸¸æˆæœç™»å½• | signature, role_id, user_name, area_id, channel, platform | signatureä»select_areaè·å–ï¼Œrole_idä»select_areaè·å–ï¼Œuser_nameä»authè·å– |
| `sleep` | ç­‰å¾…æŒ‡å®šæ—¶é—´ | seconds | - |
| `print` | è¾“å‡ºè°ƒè¯•ä¿¡æ¯ | message | - |

## ğŸ¯ è‡ªåŠ¨å‚æ•°è·å–åŠŸèƒ½

### connect_gate å‘½ä»¤
- è‡ªåŠ¨ä» `select_area` è¿”å›å€¼ä¸­è·å– `GateHost` å’Œ `GateTcpPort`
- å¦‚æœæ²¡æœ‰ `select_area` ç»“æœï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤å€¼

### login å‘½ä»¤
- **signature**: è‡ªåŠ¨ä» `select_area` è¿”å›å€¼çš„ `Signature` å­—æ®µè·å–
- **role_id**: è‡ªåŠ¨ä» `select_area` è¿”å›å€¼çš„ `RoleId` å­—æ®µè·å–  
- **user_name**: è‡ªåŠ¨ä» `auth` è¿”å›å€¼çš„ `OpenId` å­—æ®µè·å–
- å¦‚æœè„šæœ¬ä¸­æä¾›äº†è¿™äº›å‚æ•°ï¼Œå°†ä¼˜å…ˆä½¿ç”¨æä¾›çš„å€¼

## ğŸ“‹ è„šæœ¬æ ¼å¼

è„šæœ¬ä½¿ç”¨JSONæ ¼å¼ï¼Œæ¯ä¸ªå‘½ä»¤åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```json
{
  "cmd": "å‘½ä»¤å",
  "å‚æ•°å": "å‚æ•°å€¼",
  "timeout": 30
}
```

### ç¤ºä¾‹è„šæœ¬

#### ç®€åŒ–ç‰ˆæœ¬ï¼ˆä½¿ç”¨è‡ªåŠ¨å‚æ•°è·å–ï¼‰
```json
[
  {
    "cmd": "auth",
    "user_name": "q1",
    "channel": "dev"
  },
  {
    "cmd": "select_area",
    "open_id": "ret[\"auth\"][\"OpenId\"]",
    "area_id": 1,
    "login_token": "ret[\"auth\"][\"LoginToken\"]"
  },
  {
    "cmd": "connect_gate"
  },
  {
    "cmd": "login"
  }
]
```

#### å®Œæ•´ç‰ˆæœ¬ï¼ˆæ‰‹åŠ¨æŒ‡å®šå‚æ•°ï¼‰
```json
[
  {
    "cmd": "auth",
    "user_name": "q1",
    "channel": "dev"
  },
  {
    "cmd": "select_area",
    "open_id": "ret[\"auth\"][\"OpenId\"]",
    "area_id": 1,
    "login_token": "ret[\"auth\"][\"LoginToken\"]"
  },
  {
    "cmd": "connect_gate"
  },
  {
    "cmd": "login",
    "signature": "ret[\"select_area\"][\"Signature\"]",
    "role_id": "ret[\"select_area\"][\"RoleId\"]",
    "user_name": "ret[\"auth\"][\"OpenId\"]"
  }
]
```

## ğŸ’¡ å‚æ•°å¼•ç”¨

æ”¯æŒä¸¤ç§å‚æ•°å¼•ç”¨æ–¹å¼ï¼š

1. **å­—æ®µå¼•ç”¨**: `ret["å‘½ä»¤å"]["å­—æ®µå"]`
   - ä¾‹: `ret["auth"]["OpenId"]` è·å–è®¤è¯è¿”å›çš„OpenId

2. **å®Œæ•´å¼•ç”¨**: `ret["å‘½ä»¤å"]`
   - ä¾‹: `ret["auth"]` è·å–è®¤è¯çš„å®Œæ•´è¿”å›ç»“æœ

## ğŸ® ä½¿ç”¨åœºæ™¯

### 1. å®Œæ•´ç™»å½•æµç¨‹æµ‹è¯•
```json
auth â†’ select_area â†’ connect_gate â†’ login
```

### 2. ä»…HTTPè®¤è¯æµ‹è¯•
```json
auth â†’ select_area
```

### 3. ç›´æ¥ç™»å½•æµ‹è¯•
```json
connect_gate â†’ login (ä½¿ç”¨é¢„è®¾signature)
```

## ğŸ”§ å·¥å…·ä½¿ç”¨

### è„šæœ¬ç¼–è¾‘å™¨
- äº¤äº’å¼åˆ›å»ºå’Œç¼–è¾‘è„šæœ¬
- æ”¯æŒå‚æ•°æç¤ºå’ŒéªŒè¯
- å¯ä»¥ä¿å­˜/åŠ è½½è„šæœ¬æ–‡ä»¶

### å¿«é€Ÿè¿è¡Œå™¨
- å¿«é€Ÿè¿è¡Œç¤ºä¾‹è„šæœ¬
- æ”¯æŒæŸ¥çœ‹è„šæœ¬å†…å®¹
- æ”¯æŒå‘½ä»¤è¡Œå‚æ•°

## âš¡ é«˜çº§åŠŸèƒ½

### 1. å¼‚æ­¥æ‰§è¡Œ
è„šæœ¬æ”¯æŒå¼‚æ­¥æ‰§è¡Œï¼Œä¼šç­‰å¾…æ¯ä¸ªå‘½ä»¤å®Œæˆåå†æ‰§è¡Œä¸‹ä¸€ä¸ªã€‚

### 2. è¶…æ—¶æ§åˆ¶
æ¯ä¸ªå‘½ä»¤éƒ½å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š

```json
{
  "cmd": "login",
  "signature": "...",
  "timeout": 60
}
```

### 3. é”™è¯¯å¤„ç†
- è‡ªåŠ¨æ•è·å’Œæ˜¾ç¤ºæ‰§è¡Œé”™è¯¯
- æ”¯æŒç»§ç»­æ‰§è¡Œæˆ–åœæ­¢è„šæœ¬

### 4. ç»“æœå­˜å‚¨
- æ¯ä¸ªå‘½ä»¤çš„è¿”å›ç»“æœéƒ½ä¼šè¢«ä¿å­˜
- åç»­å‘½ä»¤å¯ä»¥å¼•ç”¨ä¹‹å‰çš„ç»“æœ

## ğŸ“Š æ‰§è¡Œç¤ºä¾‹

```
ğŸš€ å¼€å§‹æ‰§è¡Œè„šæœ¬...
ğŸ“‹ å…±æœ‰ 4 ä¸ªå‘½ä»¤
==================================================
ğŸ”„ [1/4] æ‰§è¡Œå‘½ä»¤: auth
ğŸ“ å‚æ•°: {'user_name': 'q1', 'channel': 'dev'}
âœ… å‘½ä»¤ auth æ‰§è¡Œå®Œæˆ
ğŸ“¤ è¿”å›ç»“æœ: {'OpenId': '12345', 'LoginToken': 'abc123'}
------------------------------
ğŸ”„ [2/4] æ‰§è¡Œå‘½ä»¤: select_area
ğŸ“ å‚æ•°: {'open_id': '12345', 'area_id': 1, 'login_token': 'abc123'}
âœ… å‘½ä»¤ select_area æ‰§è¡Œå®Œæˆ
ğŸ“¤ è¿”å›ç»“æœ: {'Signature': 'xyz789'}
------------------------------
ğŸ‰ è„šæœ¬æ‰§è¡Œå®Œæˆ!
```

## ğŸ› æ•…éšœæ’é™¤

### 1. è¿æ¥å¤±è´¥
- æ£€æŸ¥ `config/config.yml` ä¸­çš„æœåŠ¡å™¨é…ç½®
- ç¡®ä¿ç›®æ ‡æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ

### 2. å‚æ•°å¼•ç”¨é”™è¯¯
- æ£€æŸ¥å‚æ•°å¼•ç”¨æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®ä¿è¢«å¼•ç”¨çš„å‘½ä»¤å·²ç»æ‰§è¡Œå¹¶è¿”å›ç»“æœ

### 3. è¶…æ—¶é”™è¯¯
- å¢åŠ å‘½ä»¤çš„è¶…æ—¶æ—¶é—´
- æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### 4. åè®®é”™è¯¯
- ç¡®ä¿protoæ–‡ä»¶è·¯å¾„é…ç½®æ­£ç¡®
- æ£€æŸ¥åè®®IDæ˜¯å¦åŒ¹é…

## ğŸ’» å¼€å‘è¯´æ˜

### æ‰©å±•æ–°å‘½ä»¤

1. åœ¨ `ScriptExecutor` ç±»ä¸­æ·»åŠ å‘½ä»¤å‡½æ•°ï¼š

```python
def _new_command(self, param1: str, param2: int = 0) -> Dict[str, Any]:
    """æ–°å‘½ä»¤å®ç°"""
    # æ‰§è¡Œé€»è¾‘
    result = {"success": True}
    self._complete_command("new_command", result)
    return result
```

2. åœ¨ `_register_commands` æ–¹æ³•ä¸­æ³¨å†Œï¼š

```python
self.command_functions["new_command"] = self._new_command
```

### è‡ªå®šä¹‰å‚æ•°è§£æ

å¯ä»¥æ‰©å±• `_resolve_value` æ–¹æ³•æ¥æ”¯æŒæ›´å¤æ‚çš„å‚æ•°å¼•ç”¨æ ¼å¼ã€‚

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬
- æ”¯æŒåŸºæœ¬çš„å‘½ä»¤æ‰§è¡Œå’Œå‚æ•°å¼•ç”¨
- æä¾›äº¤äº’å¼ç¼–è¾‘å™¨å’Œå¿«é€Ÿè¿è¡Œå™¨
- åŒ…å«å®Œæ•´çš„ç¤ºä¾‹è„šæœ¬
